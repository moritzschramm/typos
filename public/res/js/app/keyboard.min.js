function kb_init(a){$.get(kb_layoutURI+kb_layout+".json",function(e,t){if("success"==t){kb_locale=e.meta.locale,kb_ratio=e.meta.ratio;for(var i="",l=0;l<e.keys.length;l++){var s=e.keys[l],n=s.id,h=s.label,k="left:"+s.left+"%;",b="top:"+s.top+"%;",o=s.parentKeyId,c=s.highlightClass,_="key",d="";if(void 0!==s.classes)for(var r=0;r<s.classes.length;r++)_+=" "+s.classes[r];if(void 0!==s.style&&(d+=s.style),kb_keys[n]={label:h,parentKeyId:o,highlightClass:c},void 0!==s.map.special){var g=void 0!==s.map.location?s.map.location:"";kb_specialMap[s.map.special+g]=n}else kb_defaultMap[s.map.default]=n,kb_shiftMap[s.map.shift]=n,kb_altGrMap[s.map.altGr]=n;i+='<div id="'+n+'" class="'+_+'" style="'+k+b+d+'">'+h+"</div>"}i+='<canvas class="hud" id="hud" width="960" height="320"></canvas>',$("#keyboard").append(i),(kb_canvas=document.getElementById("hud").getContext("2d")).lineWidth=kb_canvas_lineWidth,kb_canvas.globalAlpha=kb_canvas_globalAlpha,kb_setSize(),a(app_modules.keyboard)}else console.error("Error while fetching keyboard layout. Returned status code: "+t)})}function kb_setSize(){kb_width=$("#keyboard").width(),kb_height=kb_width/kb_ratio,$("#keyboard").css("height",kb_height+"px"),kb_canvas.canvas.width=kb_width,kb_canvas.canvas.height=kb_height}function kb_highlightAllKeys(){for(var a in kb_keys)kb_highlightKey(a)}function kb_unhighlightAllKeys(){for(var a in kb_keys)kb_unhighlightKey(a)}function kb_highlightKey(a){kb_lastHighlightedKeyId=a;var e=kb_keys[a];$("#"+a).addClass(e.highlightClass);var t=kb_getColorFromClass(e.highlightClass);kb_drawConnection(e.parentKeyId,a,t)}function kb_unhighlightKey(a){var e=kb_keys[a];void 0!==e&&$("#"+a).removeClass(e.highlightClass),kb_clearCanvas()}function kb_activateKey(a){$("#"+a).addClass("activekey")}function kb_deactivateKey(a){$("#"+a).removeClass("activekey")}function kb_drawConnection(a,e,t){var i=document.getElementById(a),l=document.getElementById(e),s=i.offsetLeft+i.clientWidth/2,n=i.offsetTop+i.clientHeight/2,h=l.offsetLeft+l.clientWidth/2,k=l.offsetTop+l.clientHeight/2;kb_canvas.strokeStyle=t,kb_canvas.lineWidth=kb_canvas_lineWidth,kb_canvas.globalAlpha=kb_canvas_globalAlpha,kb_canvas.beginPath(),kb_canvas.moveTo(s,n),kb_canvas.lineTo(h,k),kb_canvas.stroke()}function kb_clearCanvas(){kb_canvas.clearRect(0,0,kb_canvas.canvas.width,kb_canvas.canvas.width)}function kb_getColorFromClass(a){switch(a){case"highlightGreen":return"#00c853";case"highlightPurple":return"#673ab7";case"highlightRed":return"#f44336";case"highlightYellow":return"#ffc107";default:return"#03a9f4"}}var kb_keys=[],kb_canvas,kb_specialMap=[],kb_defaultMap=[],kb_shiftMap=[],kb_altGrMap=[],kb_layout="",kb_locale="",kb_width=0,kb_height=0,kb_ratio=3,kb_canvas_lineWidth=2,kb_canvas_globalAlpha=.8,kb_isCapslock=!1,kb_layoutURI="/res/js/keyboard_layouts/";$(window).resize(kb_setSize);var kb_lastHighlightedKeyId;